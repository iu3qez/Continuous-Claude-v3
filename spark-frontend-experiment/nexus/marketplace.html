<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Marketplace | Workbook</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              heading: ['Playfair Display', 'Georgia', 'serif'],
              body: ['Inter', 'system-ui', 'sans-serif'],
              mono: ['JetBrains Mono', 'monospace'],
            },
            colors: {
              surface: { DEFAULT: '#161618', dark: '#0C0C0E', ai: '#14141A' },
              border: { DEFAULT: '#232326' },
              txt: { primary: '#EDEDEF', secondary: '#8F8F94', tertiary: '#6B6B70' },
              accent: { DEFAULT: '#4F46E5', hover: '#6366F1' },
              danger: { DEFAULT: '#DC2626' },
              warning: { DEFAULT: '#D97706' },
              success: { DEFAULT: '#059669' },
              gold: { DEFAULT: '#B45309' },
            }
          }
        }
      }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles/nexus-tokens.css">
    <link rel="stylesheet" href="styles/interactions.css">
    <link rel="stylesheet" href="styles/animations.css">
    <link rel="stylesheet" href="styles/skeleton.css">
  <link rel="stylesheet" href="styles/transitions.css">

    <style>
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--surface-dark);
        }

        /* Search and Sort Inputs */
        #searchInput,
        #sortSelect {
            background: var(--surface-elevated);
            border: 1px solid var(--border);
            color: var(--txt-primary);
            transition: var(--transition-base);
        }

        #searchInput::placeholder {
            color: var(--txt-tertiary);
        }

        #searchInput:focus,
        #sortSelect:focus {
            border-color: var(--accent);
            outline: none;
        }

        /* Category Chips */
        .category-chip {
            padding: 8px 16px;
            background: transparent;
            color: var(--txt-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-base);
        }

        .category-chip:hover {
            background: var(--surface-hover);
            color: var(--txt-primary);
        }

        .category-chip.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Agent Cards */
        .agent-card {
            background: var(--surface-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            transition: all var(--transition-base);
        }

        .agent-card:hover {
            border-color: var(--border-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Preview Button */
        .preview-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--txt-primary);
            transition: var(--transition-base);
        }

        .preview-btn:hover {
            background: var(--surface-hover);
            border-color: var(--border-hover);
        }

        /* Star Rating */
        .star-rating {
            color: #D97706;
        }

        /* Toast */
        #toast {
            background: var(--surface-elevated);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-md);
        }
    </style>
</head>
<body class="bg-surface-dark text-txt-primary" data-page-id="marketplace">
    <div class="flex min-h-screen">
        <!-- Sidebar - 240px full-width -->
        <aside id="sidebar" class="sidebar-bg w-60 bg-[#0C0C0E] border-r border-[#232326] flex flex-col py-4 px-3 gap-0.5 h-screen overflow-y-auto flex-shrink-0">
          <div class="flex items-center gap-2.5 px-2 mb-4">
            <div class="w-8 h-8 rounded-lg bg-[#4F46E5] flex items-center justify-center flex-shrink-0"><i data-lucide="book-open" class="w-4 h-4 text-white"></i></div>
            <span class="font-heading text-base font-semibold text-[#EDEDEF] tracking-tight">Workbook</span>
          </div>
          <button onclick="document.getElementById('cmdInput')?.focus()" class="nav-item flex items-center gap-2.5 px-2 py-1.5 rounded-md mb-3 group w-full text-left" title="Search (Cmd+K)">
            <i data-lucide="search" class="w-4 h-4 text-[#8F8F94] group-hover:text-[#EDEDEF] flex-shrink-0"></i>
            <span class="text-sm text-[#6B6B70]">Search</span>
            <span class="ml-auto font-mono text-[10px] text-[#6B6B70]/60 bg-[#232326] px-1.5 py-0.5 rounded">Cmd+K</span>
          </button>
          <div class="mb-1">
            <div class="px-2 py-1 text-[10px] font-mono font-semibold text-[#6B6B70] uppercase tracking-widest">Workspace</div>
            <a href="dashboard.html" data-nav-page="dashboard" class="nav-item flex items-center gap-2.5 px-2 py-1.5 rounded-md text-[#8F8F94] hover:text-[#EDEDEF]"><i data-lucide="layout-dashboard" class="w-4 h-4 flex-shrink-0"></i><span class="text-sm">Dashboard</span></a>
            <a href="calendar.html" data-nav-page="calendar" class="nav-item flex items-center gap-2.5 px-2 py-1.5 rounded-md text-[#8F8F94] hover:text-[#EDEDEF]"><i data-lucide="calendar" class="w-4 h-4 flex-shrink-0"></i><span class="text-sm">Calendar</span></a>
            <a href="meetings.html" data-nav-page="meetings" class="nav-item flex items-center gap-2.5 px-2 py-1.5 rounded-md text-[#8F8F94] hover:text-[#EDEDEF]"><i data-lucide="users" class="w-4 h-4 flex-shrink-0"></i><span class="text-sm">Meetings</span></a>
            <a href="actions.html" data-nav-page="actions" class="nav-item flex items-center gap-2.5 px-2 py-1.5 rounded-md text-[#8F8F94] hover:text-[#EDEDEF]"><i data-lucide="check-square" class="w-4 h-4 flex-shrink-0"></i><span class="text-sm">Actions</span></a>
            <a href="decisions.html" data-nav-page="decisions" class="nav-item flex items-center gap-2.5 px-2 py-1.5 rounded-md text-[#8F8F94] hover:text-[#EDEDEF]"><i data-lucide="git-branch" class="w-4 h-4 flex-shrink-0"></i><span class="text-sm">Decisions</span></a>
            <a href="proposals.html" data-nav-page="proposals" class="nav-item flex items-center gap-2.5 px-2 py-1.5 rounded-md text-[#8F8F94] hover:text-[#EDEDEF]"><i data-lucide="sparkles" class="w-4 h-4 flex-shrink-0"></i><span class="text-sm">Proposals</span></a>
            <a href="my-work.html" data-nav-page="my-work" class="nav-item flex items-center gap-2.5 px-2 py-1.5 rounded-md text-[#8F8F94] hover:text-[#EDEDEF]"><i data-lucide="user" class="w-4 h-4 flex-shrink-0"></i><span class="text-sm">My Work</span></a>
            <a href="workspaces.html" data-nav-page="workspaces" class="nav-item flex items-center gap-2.5 px-2 py-1.5 rounded-md text-[#8F8F94] hover:text-[#EDEDEF]" title="Workspaces">
              <i data-lucide="layers" class="w-4 h-4 flex-shrink-0"></i>
              <span class="text-sm">Workspaces</span>
            </a>
          </div>
          <div class="mb-1">
            <div class="px-2 py-1 text-[10px] font-mono font-semibold text-[#6B6B70] uppercase tracking-widest">AI</div>
            <a href="agents.html" data-nav-page="agents" class="nav-item flex items-center gap-2.5 px-2 py-1.5 rounded-md text-[#8F8F94] hover:text-[#EDEDEF]"><i data-lucide="bot" class="w-4 h-4 flex-shrink-0"></i><span class="text-sm">Agent Dashboard</span></a>
            <a href="marketplace.html" data-nav-page="marketplace" class="nav-active nav-item flex items-center gap-2.5 px-2 py-1.5 rounded-md text-[#4F46E5]"><i data-lucide="store" class="w-4 h-4 flex-shrink-0"></i><span class="text-sm">Marketplace</span></a>
            <a href="elt-rollup.html" data-nav-page="elt-rollup" class="nav-item flex items-center gap-2.5 px-2 py-1.5 rounded-md text-[#8F8F94] hover:text-[#EDEDEF]"><i data-lucide="bar-chart-3" class="w-4 h-4 flex-shrink-0"></i><span class="text-sm">ELT Rollup</span></a>
          </div>
          <div class="mb-1">
            <div class="px-2 py-1 text-[10px] font-mono font-semibold text-[#6B6B70] uppercase tracking-widest">Admin</div>
            <a href="connections.html" data-nav-page="connections" class="nav-item flex items-center gap-2.5 px-2 py-1.5 rounded-md text-[#8F8F94] hover:text-[#EDEDEF]"><i data-lucide="plug" class="w-4 h-4 flex-shrink-0"></i><span class="text-sm">Connections</span></a>
            <a href="settings.html" data-nav-page="settings" class="nav-item flex items-center gap-2.5 px-2 py-1.5 rounded-md text-[#8F8F94] hover:text-[#EDEDEF]"><i data-lucide="settings" class="w-4 h-4 flex-shrink-0"></i><span class="text-sm">Settings</span></a>
          </div>
          <div class="flex-1"></div>
          <div class="flex items-center gap-2.5 px-2 py-1.5">
            <i data-lucide="bot" class="w-4 h-4 text-[#6B6B70]"></i>
            <span class="text-xs text-[#6B6B70]">AI Agent</span>
            <span class="ml-auto flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-[#059669]"></span><span class="text-[10px] text-[#059669] font-mono">Online</span></span>
          </div>
          <button onclick="document.documentElement.classList.toggle('dark')" class="nav-item flex items-center gap-2.5 px-2 py-1.5 rounded-md text-[#8F8F94] hover:text-[#EDEDEF] w-full text-left">
            <i data-lucide="sun-moon" class="w-4 h-4 flex-shrink-0"></i><span class="text-sm">Toggle Theme</span>
          </button>
          <div class="flex items-center gap-2.5 px-2 py-1.5 mt-1">
            <div class="w-7 h-7 rounded-full bg-[#232326] flex items-center justify-center flex-shrink-0"><span class="font-mono text-[10px] text-[#8F8F94] font-medium">DH</span></div>
            <span class="text-sm text-[#8F8F94]">David Hayes</span>
          </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto bg-surface-dark">
            <div class="max-w-7xl mx-auto p-8">
                <!-- Header Section -->
                <header class="mb-8">
                    <h1 class="text-3xl font-bold mb-2 text-txt-primary">Agent Marketplace</h1>
                    <p class="txt-secondary text-base mb-6">Discover and install AI agents for your workflows</p>

                    <!-- Search and Filters -->
                    <div class="flex flex-col sm:flex-row gap-4 mb-6">
                        <div class="flex-1">
                            <input
                                type="text"
                                id="searchInput"
                                placeholder="Search agents..."
                                class="w-full px-4 py-2 rounded-lg"
                            >
                        </div>

                        <div class="relative">
                            <select
                                id="sortSelect"
                                class="px-4 py-2 rounded-lg cursor-pointer appearance-none pr-10"
                            >
                                <option value="popular">Most Popular</option>
                                <option value="rated">Highest Rated</option>
                                <option value="newest">Newest</option>
                            </select>
                            <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 pointer-events-none" style="color: var(--txt-secondary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                    </div>

                    <!-- Category Filters -->
                    <div class="flex flex-wrap gap-2">
                        <button class="category-chip active" data-category="all">All</button>
                        <button class="category-chip" data-category="sales">Sales</button>
                        <button class="category-chip" data-category="operations">Operations</button>
                        <button class="category-chip" data-category="engineering">Engineering</button>
                        <button class="category-chip" data-category="finance">Finance</button>
                        <button class="category-chip" data-category="hr">HR</button>
                        <button class="category-chip" data-category="custom">Custom</button>
                    </div>
                </header>

                <!-- Agent Grid -->
                <div id="agentGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Agent cards will be rendered here -->
                </div>

                <!-- Custom Agent Builder Banner -->
                <div class="bg-gradient-to-r from-accent/20 to-accent/10 border border-accent/30 rounded-lg p-8 text-center">
                    <h2 class="text-2xl font-bold mb-3">Build Your Own Agent</h2>
                    <p class="txt-secondary text-base mb-6 max-w-2xl mx-auto">
                        Create custom AI agents tailored to your unique processes. No code required.
                    </p>
                    <button class="px-6 py-3 bg-accent text-white rounded-lg font-semibold hover:bg-accent/90 transition-colors">
                        Start Building
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-8 right-8 rounded-lg p-4 shadow-lg transform translate-y-32 opacity-0 transition-all duration-300 z-50">
        <p class="text-sm font-medium" style="color: var(--txt-primary);">Coming Soon</p>
    </div>

    <!-- Shared Components -->
    <script src="sidebar.js"></script>

    <script>
        // Agent data
        const agents = [
            {
                id: 1,
                name: "Meeting Prep Pro",
                category: "operations",
                description: "Automated meeting prep with CRM context and action tracking",
                rating: 4.9,
                installs: "3.2K",
                icon: "üìÖ",
                color: "bg-blue-500"
            },
            {
                id: 2,
                name: "Sales Pipeline Guardian",
                category: "sales",
                description: "Monitors deal health and alerts on risk signals",
                rating: 4.8,
                installs: "2.8K",
                icon: "üéØ",
                color: "bg-green-500"
            },
            {
                id: 3,
                name: "Action Enforcer",
                category: "operations",
                description: "Tracks action items and sends follow-ups automatically",
                rating: 4.7,
                installs: "4.1K",
                icon: "‚úì",
                color: "bg-purple-500"
            },
            {
                id: 4,
                name: "Compliance Scanner",
                category: "finance",
                description: "Monitors regulatory deadlines and policy compliance",
                rating: 4.9,
                installs: "1.9K",
                icon: "üîç",
                color: "bg-red-500"
            },
            {
                id: 5,
                name: "Report Builder",
                category: "operations",
                description: "Generates executive reports from connected data",
                rating: 4.6,
                installs: "3.5K",
                icon: "üìä",
                color: "bg-indigo-500"
            },
            {
                id: 6,
                name: "Email Summarizer",
                category: "operations",
                description: "Summarizes long email threads into key points",
                rating: 4.8,
                installs: "5.2K",
                icon: "‚úâ",
                color: "bg-cyan-500"
            },
            {
                id: 7,
                name: "Code Review Assistant",
                category: "engineering",
                description: "Reviews PRs and suggests improvements",
                rating: 4.7,
                installs: "2.1K",
                icon: "üíª",
                color: "bg-emerald-500"
            },
            {
                id: 8,
                name: "Budget Monitor",
                category: "finance",
                description: "Tracks spending against budgets with alerts",
                rating: 4.5,
                installs: "1.4K",
                icon: "üí∞",
                color: "bg-yellow-500"
            },
            {
                id: 9,
                name: "Hiring Coordinator",
                category: "hr",
                description: "Streamlines interview scheduling and feedback collection",
                rating: 4.6,
                installs: "980",
                icon: "üë•",
                color: "bg-pink-500"
            },
            {
                id: 10,
                name: "Campaign Analyst",
                category: "sales",
                description: "Analyzes marketing campaign performance in real-time",
                rating: 4.4,
                installs: "1.7K",
                icon: "üìà",
                color: "bg-orange-500"
            },
            {
                id: 11,
                name: "Knowledge Base Builder",
                category: "engineering",
                description: "Auto-generates documentation from conversations",
                rating: 4.3,
                installs: "890",
                icon: "üìö",
                color: "bg-teal-500"
            },
            {
                id: 12,
                name: "Customer Success Monitor",
                category: "sales",
                description: "Tracks customer health scores and churn signals",
                rating: 4.9,
                installs: "2.6K",
                icon: "‚ù§",
                color: "bg-rose-500"
            }
        ];

        // State
        let currentCategory = 'all';
        let currentSort = 'popular';
        let searchQuery = '';

        // Category color mapping
        const categoryColors = {
            sales: 'bg-green-500/10 text-green-400 border-green-500/20',
            operations: 'bg-blue-500/10 text-blue-400 border-blue-500/20',
            engineering: 'bg-purple-500/10 text-purple-400 border-purple-500/20',
            finance: 'bg-yellow-500/10 text-yellow-400 border-yellow-500/20',
            hr: 'bg-pink-500/10 text-pink-400 border-pink-500/20',
            custom: 'bg-gray-500/10 text-gray-400 border-gray-500/20'
        };

        // Render agent card
        function renderAgentCard(agent) {
            const categoryClass = categoryColors[agent.category];

            return `
                <div class="agent-card p-6 fade-in" data-category="${agent.category}">
                    <div class="flex items-start gap-4 mb-4">
                        <div class="${agent.color} w-12 h-12 rounded-full flex items-center justify-center text-2xl flex-shrink-0">
                            ${agent.icon}
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="font-semibold text-base mb-1 truncate" style="color: var(--txt-primary);">${agent.name}</h3>
                            <span class="inline-block px-2 py-1 text-xs rounded border ${categoryClass} capitalize">
                                ${agent.category}
                            </span>
                        </div>
                    </div>

                    <p class="text-sm mb-4 line-clamp-2 min-h-[2.5rem]" style="color: var(--txt-secondary);">
                        ${agent.description}
                    </p>

                    <div class="flex items-center gap-4 mb-4 text-sm" style="color: var(--txt-secondary);">
                        <div class="flex items-center gap-1 star-rating">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                            </svg>
                            <span>${agent.rating}</span>
                        </div>
                        <div>${agent.installs} installs</div>
                    </div>

                    <div class="flex gap-2">
                        <button class="preview-btn flex-1 px-4 py-2 rounded-lg text-sm font-medium">
                            Preview
                        </button>
                        <button class="flex-1 px-4 py-2 bg-accent text-white rounded-lg text-sm font-medium hover:bg-accent/90 transition-colors install-btn">
                            Install
                        </button>
                    </div>
                </div>
            `;
        }

        // Filter and sort agents
        function getFilteredAgents() {
            let filtered = agents;

            // Filter by category
            if (currentCategory !== 'all') {
                filtered = filtered.filter(a => a.category === currentCategory);
            }

            // Filter by search
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                filtered = filtered.filter(a =>
                    a.name.toLowerCase().includes(query) ||
                    a.description.toLowerCase().includes(query) ||
                    a.category.toLowerCase().includes(query)
                );
            }

            // Sort
            if (currentSort === 'popular') {
                filtered.sort((a, b) => {
                    const aNum = parseFloat(a.installs.replace('K', '')) * 1000;
                    const bNum = parseFloat(b.installs.replace('K', '')) * 1000;
                    return bNum - aNum;
                });
            } else if (currentSort === 'rated') {
                filtered.sort((a, b) => b.rating - a.rating);
            } else if (currentSort === 'newest') {
                filtered.reverse();
            }

            return filtered;
        }

        // Render grid
        function renderGrid() {
            const grid = document.getElementById('agentGrid');
            const filtered = getFilteredAgents();

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-16 txt-secondary">
                        <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p class="text-lg">No agents found</p>
                        <p class="text-sm mt-2">Try adjusting your filters or search query</p>
                    </div>
                `;
            } else {
                grid.innerHTML = filtered.map(renderAgentCard).join('');

                // Add install button listeners
                document.querySelectorAll('.install-btn').forEach(btn => {
                    btn.addEventListener('click', showToast);
                });
            }
        }

        // Show toast notification
        function showToast() {
            const toast = document.getElementById('toast');
            toast.classList.remove('translate-y-32', 'opacity-0');
            toast.classList.add('translate-y-0', 'opacity-100');

            setTimeout(() => {
                toast.classList.remove('translate-y-0', 'opacity-100');
                toast.classList.add('translate-y-32', 'opacity-0');
            }, 2000);
        }

        // Category chip click handler
        document.querySelectorAll('.category-chip').forEach(chip => {
            chip.addEventListener('click', (e) => {
                document.querySelectorAll('.category-chip').forEach(c => c.classList.remove('active'));
                e.target.classList.add('active');
                currentCategory = e.target.dataset.category;
                renderGrid();
            });
        });

        // Search input handler
        document.getElementById('searchInput').addEventListener('input', (e) => {
            searchQuery = e.target.value;
            renderGrid();
        });

        // Sort select handler
        document.getElementById('sortSelect').addEventListener('change', (e) => {
            currentSort = e.target.value;
            renderGrid();
        });

        // Initial render
        renderGrid();

        // Expose to window for module script access
        window.getFilteredAgents = getFilteredAgents;
        window.marketplaceAgents = agents;

        // Initialize sidebar with active page
        document.addEventListener('DOMContentLoaded', () => {
            if (window.initializeSidebar) {
                initializeSidebar('marketplace');
            }
        });
    </script>

    <!-- Preview Modal Integration -->
    <script type="module">
        import { showAgentPreview } from './components/marketplace-preview.js';

        // Wire preview buttons after grid renders
        function attachPreviewListeners() {
            document.querySelectorAll('.preview-btn').forEach((btn, index) => {
                btn.addEventListener('click', () => {
                    var filtered = window.getFilteredAgents ? window.getFilteredAgents() : (window.marketplaceAgents || []);
                    if (filtered && filtered[index]) {
                        showAgentPreview(filtered[index]);
                    }
                });
            });
        }

        // Attach listeners on initial load
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(attachPreviewListeners, 100);
        });

        // Re-attach after each filter/search/sort (observe DOM changes)
        const observer = new MutationObserver(() => {
            attachPreviewListeners();
        });

        const agentGrid = document.getElementById('agentGrid');
        if (agentGrid) {
            observer.observe(agentGrid, { childList: true });
        }
    </script>
  <script type="module" src="components/page-init.js"></script>
  <script type="module" src="demo/init.js"></script>
  <script src="components/page-transitions.js"></script>
</body>
</html>
